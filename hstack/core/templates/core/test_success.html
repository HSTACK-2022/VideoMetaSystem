<!-- extends 'core/upload_detail.html' %} -->
<script
    src="https://code.jquery.com/jquery-3.6.0.slim.js"
    integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
    crossorigin="anonymous"></script>
<!DOCTYPE html>
{% load static %}
<html>
    {% for metadata in metadatas %}
    <head>
        <title>VIFO -
        {{metadata.title}}
        </title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="{% static 'css/videoDetail.css' %}?after">
        <!-- submit check -->
    </head>
    <body class="bodyArea">
    {% include 'core/test_header.html' %}
            
        <form onsubmit="return validCheck()" method="POST" id="form">      
        {% csrf_token %}
            <script>
                function validCheck() {
                    var i = 0;
                    // sys defined keywordÏùò exposeÎ•º sysKEList(system Keyword Expose List) Ï†ÑÎã¨
                    for(var key in sysKEList){
                        var kk = document.createElement('input');
                        kk.setAttribute("type","hidden");
                        kk.setAttribute("name","sysKEList");
                        kk.setAttribute("value",sysKEList[i]);
                        document.getElementById('form').append(kk);
                        i++;
                    }
                    // user defined keywordÏùò exposeÎ•º  Ï†ÑÎã¨
                    var i = 0;
                    for(var key in userKEList){
                        var kk = document.createElement('input');
                        kk.setAttribute("type","hidden");
                        kk.setAttribute("name","userKEList");
                        kk.setAttribute("value",userKEList[i]);
                        document.getElementById('form').append(kk);
                        i++;
                    }
                    // ÏÉàÎ°≠Í≤å Ï∂îÍ∞ÄÎêú user defined keywordÏùò contentÏôÄ exposeÏó¨Î∂Ä Ï†ÑÎã¨
                    var i = 0;
                    for(var key in newUserKEList){
                        var kk = document.createElement('input');
                        kk.setAttribute("type","hidden");
                        kk.setAttribute("name","newUserKEList");
                        kk.setAttribute("value",newUserKEList[i]);
                        document.getElementById('form').append(kk);
                        i++;
                    }
                    var i = 0;
                    for(var key in newUserKCList){
                        var kk = document.createElement('input');
                        kk.setAttribute("type","hidden");
                        kk.setAttribute("name","newUserKCList");
                        kk.setAttribute("value",newUserKCList[i]);
                        document.getElementById('form').append(kk);
                        i++;
                    }
                    location.href='/test/success/{{ii.id_id}}'
                }
            </script>
          
            <div class="divParent">
                <!-- Post content-->
                <div class="detailHeader">
                    <!-- Preview image figure-->
                    <video height="450" class="videoPlayer" id="video" src="{{videoaddr}}" controls="controls"></video>
                    <!--<div>result : {{Metadata}}</div>-->
                    <div class="box">
                        <div class="left">
                            <!-- ÌÇ§ÏõåÎìú 3Í∞úÎßå ÏàòÏ†ï@@@@@@@@@@@-->
                            <div class="keyTag">
                                {% for keyword in keywords %}
                                    {% if keyword != "" and forloop.counter < 4 %}
                                        #{{keyword.keyword}}
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <!-- Post title-->
                            <div class="videoTitle">{{ metadata.title }}</div>
                            <!-- Post meta content-->
                            <div class="videoUploadDate">{{metadata.uploaddate}}</div>
                            <div class="videoPresenter">by{{metadata.presenter}}</div>
                            <br>
                        </div> <!-- end of 'left' div side-->
                    
                
                        <div class="right">
                            <table class="metadataTable2">
                                <!-- Basic metadata -->
                                <tr>
                                    <td colspan="2">
                                        <div class="metadataTR_bottom">
                                            <div class="metadataTitle">üó∏ CATEGORY</div>
                                            <div class="metadataContent">{{metadata.category}}</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <div class="metadataTR_bottom">
                                            <div class="metadataTitle">üó∏ NARRATIVE</div>
                                            <div class="metadataContent">{{metadata.narrative}}</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <div class="metadataTR_bottom">
                                            <div class="metadataTitle">üó∏ METHOD</div>
                                            <div class="metadataContent">{{metadata.method}}</div>
                                        </div>
                                    </td>
                                </tr>
                                <!-- Keywords -->
                            </table>
                        <!--end of the 'right' div side-->
                        </div>
                    <!--end of the box div-->
                    </div>
                <!--end of the detailHeader div-->
                </div>

                    
                
                <!-- @@@@@@@@@@@@@@@@@Ïó¨Í∏∞Î∂ÄÌÑ∞ ÏôºÏ™ΩÏ∞Ω -->
                <div class="detailMetadata">
                    <div class="tabmenu">
                        <ul>
                            <!-- @@@@@@@@@@Ï≤´Î≤àÏß∏ ÌÉ≠ ÌÇ§ÏõåÎìú/Î™©Ï∞® -->
                            <li id="tab1" class="btnCon">
                                <a class="btn first" href="#tab1">Metadata</a>
                                <div class="tabCon">
                                    <table class="metadataTable">
                                        <script>
                                            var sysKEList = [];
                                            var userKEList = [];
                                            var newUserKEList = [];
                                            var newUserKCList = [];
                                            $(document).ready(function(){
                                                $("button").on('click', function(e){
                                                    // Í∞ôÏùÄ Î†àÎ≤®ÏóêÏÑú Î™áÎ≤àÏ®∞
                                                    var i = $(this).index();  
                                                    
                                                    if($(this).hasClass("keywordAddBtn"))   // ÌÇ§ÏõåÎìú ÏÉàÎ°ú Ï∂îÍ∞ÄÌïòÍ∏∞ Î≤ÑÌäºÏùÄ ÏïÑÎûò Í≥ºÏ†ï ÏïàÌïòÍ∏∞
                                                        return;
                                                    else{
                                                        console.log(i);  // *Î≤àÏß∏
                        
                                                        // system defined keyword
                                                        if($(this).hasClass("keywordsBtn")){ // exposeÍ∞Ä 1Ïù∏ Í≤ΩÏö∞
                                                            $(this).removeClass('keywordsBtn');
                                                            $(this).addClass('keywordsClickedBtn');
                                                            sysKEList.splice(i , 1 , parseInt("0"));
                                                        }else if($(this).hasClass("keywordsClickedBtn")){
                                                            $(this).removeClass('keywordsClickedBtn'); // exposeÍ∞Ä 0Ïù∏ Í≤ΩÏö∞
                                                            $(this).addClass('keywordsBtn');
                                                            sysKEList.splice(i , 1 , parseInt("1"));
                                                        }
                                                        // user defined keyword
                                                        else if($(this).hasClass("userKBtn")){
                                                            $(this).removeClass('userKBtn'); // exposeÍ∞Ä 1Ïù∏ Í≤ΩÏö∞
                                                            $(this).addClass('userKClickedBtn');
                                                            userKEList.splice(i , 1 , parseInt("0"));
                                                        }else{
                                                            $(this).removeClass('userKClickedBtn'); // exposeÍ∞Ä 0Ïù∏ Í≤ΩÏö∞
                                                            $(this).addClass('userKBtn');
                                                            userKEList.splice(i , 1 , parseInt("1"));
                                                        }
                                                        
                                                        // Ï°¥Ïû¨ÌïòÎäî Î™®Îì† Î≤ÑÌäºÏùÑ Í∏∞Ï§ÄÏúºÎ°ú index
                                                        // var j = $("button").index(this);  
                                                        // console.log(j);
                        
                                                        console.log(sysKEList);
                                                        console.log(userKEList);
                                                    }
                                                    
                                                });
                        
                        
                                                $(document).on("click", "button[class='keywordAddBtn']", function () {
                                                    var val = $("#inputKeyW").val();
                                                    $("#inputKeyW").val("");
                                                    var newKeyword = "<button type='button' id='newUserkeywordsBtn' class='userKBtn'>"+val+"</button>";
                                                    $(".userdefinedKeywords").append(newKeyword);
                                                    newUserKEList.push(parseInt("1"));
                                                    newUserKCList.push(val);
                                                });
                        
                                                $(document).on("click", "button[id='newUserkeywordsBtn']", function () {
                                                    console.log(newUserKEList);
                                                    console.log(newUserKCList);
                                                    var i = $(this).index();
                                                    i = i - userKEList.length;
                                                    if($(this).hasClass("userKBtn")){
                                                        $(this).removeClass('userKBtn'); // exposeÍ∞Ä 1Ïù∏ Í≤ΩÏö∞
                                                        $(this).addClass('userKClickedBtn');
                                                        newUserKEList.splice(i , 1 , parseInt("0"));
                                                    }else{
                                                        $(this).removeClass('userKClickedBtn'); // exposeÍ∞Ä 0Ïù∏ Í≤ΩÏö∞
                                                        $(this).addClass('userKBtn');
                                                        newUserKEList.splice(i , 1 , parseInt("1"));
                                                    }
                                                    //console.log(i);
                                                });
                        
                                            });
                                        </script>
                                        <tr>
                                            <td colspan="2">
                                                <div class="metadataTR">
                                                    <div class="metadataTitle2">KEYWORDS</div>
                                                </div>
                                            </td>
                                        </tr>
                                        
                                        <tr>
                                            <td>
                                                <input
                                                    type="hidden"
                                                    value={{keyword.keyword}}="}"
                                                    name="keywordsBtnContentList">
                                                
                                                
                                                {% for keyword in keywords %}
                                                <input type="hidden" value={{keyword.keyword}}="}" name="sysKCList">
                                                <script>
                                                    sysKEList.push({{keyword.expose}})
                                                </script>
                                                {% endfor %}

                                                {% for userkeyword in userkeywords %}
                                                <input type="hidden" value={{userkeyword.keyword}}="}" name="userKCList">
                                                <script>
                                                    userKEList.push({{userkeyword.expose}})
                                                </script>
                                                {% endfor %}
                                                
                                            </td>
                                        </tr>
                                        <tr class="metadataDetailTR">
                                            <td colspan="2" class="metadataKeywordTD">
                                    
                                                <div class="metadataTitle2">- System Defined </div>
                                                <div class="sysdefinedKeywords">
                                                    {% for keyword in keywords %}
                                                        {% if keyword.expose == 1 %}
                                                            <button type="button" id="keywordsBtn" class="keywordsBtn">{{keyword.keyword}}</button>
                                                        {% else %}
                                                            <button type="button" id="keywordsBtn" class="keywordsClickedBtn">{{keyword.keyword}}</button>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                                <hr>

                                                <div class="metadataTitle2">- User Defined </div>
                                                
                                                <input id ="save" type="submit" value="SAVE" style='cursor:pointer;'>
                                                <div class="userdefinedKeywords">
                                                    {% for userkeyword in userkeywords %}
                                                        {% if userkeyword.expose == 1 %}
                                                            <button type="button" id="userkeywordsBtn" class="userKBtn">{{userkeyword.keyword}}</button>
                                                        {% else %}
                                                            <button type="button" id="userkeywordsBtn" class="userKClickedBtn">{{userkeyword.keyword}}</button>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                                <br>
                                                <div class="innerKeyword">
                                                    <input text="text" id="inputKeyW" placeholder="ÏÉàÎ°úÏö¥ ÌÇ§ÏõåÎìú Ï∂îÍ∞ÄÌïòÍ∏∞">
                                                    <button type="button" class="keywordAddBtn"></button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="emptyTR"></tr>
                                    <!-- Keywords -->
                                    </table>


                                    <div class="searchScroll2">
                                        <!-- Î™©Ï∞® -->
                                        <table class="metadataTable">
                                            <tr>
                                                <td colspan="2">
                                                    <div class="metadataTR">
                                                        <div class="metadataTitle2">INDEX</div>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% for timestamp in timestamps %}
                                            <tr class="metadataDetailTR">
                                                <td colspan="2" class="metadataKeywordTD">
                                                    <button class="indexTime" onclick="inputMove('{{timestamp.time}}')">{{timestamp.time}}</button>
                                                    <div class="indexTitle">{{timestamp.subtitle}}</div>
                                                </td>

                                            </tr>
                                            {% endfor %}
                                            {% comment %} <input type="submit" value="Ï†ÄÏû•"> {% endcomment %}
                                        </table>
                                    </div>
                                <!-- end of the 'tabCon' div-->    
                                </div>
                            </li>

                            <script>
                                var vid = document.getElementById("video");
                                function inputMove(time) {
                                    timeStr = time.split(":");
                                    timeSec = Number(timeStr[0] * 3600) + Number(timeStr[1] * 60) + Number(
                                        timeStr[2]
                                    );
                                    vid.currentTime = timeSec;
                                    vid.play();
                                }
                            </script>

                            <!-- @@@@@@@@@ÎëêÎ≤àÏß∏ ÌÉ≠ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
                            <li id="tab2" class="btnCon">
                                <a class="btn second" href="#tab2">Script</a>
                                <div class="tabCon">

                                    <!-- detail search : only for detail -->
                                    <div class="innerSearch">
                                        <input
                                            type="text"
                                            placeholder="Search in &quot;{{ metadata.title }}&quot;"
                                            id="searchContent">
                                        <input
                                            type="submit"
                                            class="searchBtn"
                                            value=""
                                            onclick="searchPost({{scripts}});">
                                    </div>

                                    <div class="searchScroll">
                                        <table id="searchResArea" class=""></table>
                                    </div>
                                <!-- end of the "tabCon" div -->
                                </div>
                            </li>
                        </ul>
                    <!-- end of the "tabmenu" div-->
                    </div>
                <!-- end of the "detailMetadata" div-->
                </div>
            
            

                <script type="text/javascript" src="{% static 'js/videoAction.js' %}"></script>
                <script>
                    location.href = "#tab1";
                </script>   
                        
                <script>
                    var vid = document.getElementById("video");
                    function inputMove(time) {
                        timeStr = time.split(":");
                        timeSec = Number(timeStr[0] * 3600) + Number(timeStr[1] * 60) + Number(timeStr[2]);
                        vid.currentTime = timeSec;
                        vid.play();
                    }
                </script>
            <!--end of the "divParent" div-->
            </div>
        </form>         
    </body>
    {% endfor %}
</html>